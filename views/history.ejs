<!DOCTYPE html>
<html>

<head>
    <%- include common/head-items.ejs %>
    <title><%= title %></title>
    <link href="/stylesheets/history.css" media="only screen and (min-width : 740px)" rel="stylesheet"
        type="text/css" />
    <script src="//code.iconify.design/1/1.0.0-rc1/iconify.min.js"></script>
</head>

<body>
    <%# Might turn this into a partial %>
    <%# Also this file gets f***ed up by vscode when saving normally. Use Ctrl+K and then press S to prevent auto-formatting %>
    <%- include common/header.ejs %>

    <!-- There's some games in the database without a round so we'll be getting a column with a title as undefined -->
    <div class="history-area history-small-text">
        <%
            for(var round in rounds){
                let roundPoints = 0;
            %>
        <div class="history-round">
            <div class="history-h-middle">
                <div><span class="iconify large-icon" data-icon="mdi-calendar-outline"></span></div>
                <div><h2 class="vertical-align-middle"><%= "Round " + (parseInt(rounds[round].index)+1) %></h2></div>
                <div>Your points!:<span id="totalPointsRound<%=round%>"></span> </div>
                <div>Golden Try:<span class="iconify large-icon" style="color: gold" data-icon="mdi-rugby" title="Golden Try"></span>
                    <%=goldenTries[rounds[round]._id]%>
                </div>
            </div>

            <% for(var date in games[round]) {
                const fixtures = games[round][date];
            %>
            <div class="fb-column">
                <div class="history-h-middle"><h3><%=date%></h3></div>

                <% for(var gameNum in fixtures){
                    let game = fixtures[gameNum];
                %>

                <div class="fb-column thin-border">
                    <div class="fb-column" class="padding-5px">
                        <div class="fb-row" class="padding-5px">
                            <div class="fb-column padding-top-5px" style="width: 75%;">
                                <div class="text-align-center"><span class="iconify large-icon" data-icon="mdi-account-group" title="Team"></span></div>
                                <div class="text-align-center history-small-text"><%=game.teamA.name%></div>
                                <div class="text-align-center history-small-text"><%=game.teamB.name%></div>
                            </div>
                            <div class="fb-row">
                                <% let bet = bets[game._id];
                                    let result = results[game._id];
                                %>
                                <div class="fb-column padding-top-5px">
                                    <div><span class="iconify large-icon" data-icon="mdi-rugby" title="Number of Tries"></span></div>
                                    <div class="text-align-center history-small-text">
                                        <% if (bet) {
                                            let triesClass;
                                            if(result === undefined){
                                                triesClass = "";
                                            } else if(result && bet.teamATries === result.teamATries){
                                                triesClass = "history-correct";
                                            } else {
                                                triesClass = "history-wrong";
                                            }

                                        %>
                                        <span class="<%=triesClass%>"> <%= bet.teamATries%></span>
                                        <%}%>
                                    </div>
                                    <div class="text-align-center history-small-text">
                                        <% if (bet) {
                                            let triesClass;
                                            if(result === undefined){
                                                triesClass = "";
                                            } else if(bet.teamBTries === result.teamBTries){
                                                triesClass = "history-correct";
                                            } else {
                                                triesClass = "history-wrong";
                                            }

                                        %>
                                        <span class="<%=triesClass%>"> <%= bet.teamBTries%></span>
                                        <%}%>
                                    </div>
                                </div>
                                <div class="fb-column padding-top-5px">
                                    <div><span class="iconify large-icon" data-icon="mdi-trophy"  title="Winning Team"></span></div>

                                    <% if(bet) { let teamA = game.teamA.name; } %>
                                    <div class="text-align-center" style="min-height: 40%">
                                        <% if(bet) {
                                            let teamA = game.teamA.name;
                                        if(result === undefined && bet.winTeam === teamA){
                                        %><span class="iconify medium-icon" data-icon="mdi-medal"></span><%
                                        }
                                        else if(result && bet.winTeam === teamA && result.winTeam === teamA){
                                        %><span class="iconify medium-icon history-correct" data-icon="mdi-medal"></span><%
                                        } else if(result && bet.winTeam === teamA){
                                        %><span class="iconify medium-icon history-wrong" data-icon="mdi-medal"></span><%
                                        }
                                        }%>
                                    </div>
                                    <div class="text-align-center" style="min-height: 40%;">
                                        <% if(bet) {
                                            let teamB = game.teamB.name;
                                        if(result === undefined && bet.winTeam === teamB){
                                        %><span class="iconify large-icon" data-icon="mdi-medal"></span><%
                                        }
                                        else if(result && bet.winTeam === teamB && result.winTeam === teamB){
                                        %><span class="iconify large-icon history-correct" data-icon="mdi-medal"></span><%
                                        } else if(result && bet.winTeam === teamB){
                                        %><span class="iconify large-icon history-wrong" data-icon="mdi-medal"></span><%
                                        }
                                        }%>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="fb-column history-h-middle">
                        <div class="fb-row history-h-middle"><div style="width: 50%"><span class="iconify large-icon" data-icon="mdi-calculator" title="Your Points"></span></div><div class="padding-5px history-small-text">
                                <% if(bet) {
                                    roundPoints+= bet.points;

                                %><%=bet.points%><%}%>

                            </div></div>
                    </div>
                </div>

                <% }%>
            </div>

            <% }%>
            <script>document.getElementById('totalPointsRound<%=round%>').innerText = "<%=roundPoints%>";</script>
            <div style="min-height: 1em"></div>

                                </div>

                                <% }%>

                            </div>
                            <%- include common/footer.ejs %>


</body>

</html>